<!DOCTYPE html>
<html>
<head>
	<HTA:APPLICATION windowState="maximize" border="none" scroll="no" />
	<meta http-equiv="x-ua-compatible" content="ie=9">
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />
	
	<link rel="stylesheet" type="text/css" href="./resources/css/bootstrap.min.css">
	<script type="text/javascript" src="./resources/js/jquery.min.js"></script> 
	<!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
	<script type="text/javascript" src="./resources/js/bootstrap.min.js"></script> 
	<script type="text/javascript" src="./resources/js/common.js"></script> 
	
	<style>
	body {
		color: white;
		font-family: Arial, Helvetica, sans-serif;
		overflow: hidden;
	} 
	.shadow-label {
		text-shadow: black 0px 0px 3px; /* Modern browsers */
		filter: glow(color=black,strength=2); /* IE */
	}	
	.custom-panel {
		background-color: rgba(0, 0, 0, .3);
		border-style: solid;
		border-width: 1px;
		border-color: white;
		border-radius: 5px;
		padding: 2px;
	}

	</style>
</head>
<body>
	<span class="btn btn-primary pull-right" style="color: black;" onclick="window.close();"><img src="./resources/img/power.png" height="20"></img></span>
	<span class="btn btn-primary pull-right" style="color: black;" onclick="restartClientService();"><img src="./resources/img/refresh.png" height="20"></img></span>
	<span class="btn btn-primary pull-right" style="color: black;" onclick="showTemplateSelection();"><img src="./resources/img/t.png" height="20"></img></span>
	
	<div id="main">
	</div>
	<div id="divTemplateSelectionModal">
	</div>
</body>
</html>

<script>
window.selectedTemplate = 0;
window.imageSelection = 0;

window.loadTemplate = function(type, img)
{
	selectedTemplate = type;
	imageSelection = img;
	
	if (type == 0)
	{
		$('#main').load('./resources/templates/dashboard.html');
	}
	else if (type == 1)
	{
		$('#main').load('./resources/templates/rainfall.html');
	}
	else if (type == 2)
	{
		$('#main').load('./resources/templates/temp.html', function () {
			if (img != '0')
			{
				$("#imgConditions").attr('src',img);
			}
		});
	}
	else if (type == 3)
	{
		$('#main').load('./resources/templates/winds.html');
	}
}

function restartClientService()
{
	MyObject = new ActiveXObject("WScript.Shell")
	MyObject.Run("\".\\resources\\restartservice.bat\"");
}

function showTemplateSelection()
{
	$('#main').html('');
	$("body").css("background-image","url('./resources/img/background-clouds.jpg')");
	
	replaceView_GET('divTemplateSelectionModal', './resources/modals/templateselection-modal.html', function () {
		templateSelectionModal_Init(selectedTemplate, imageSelection);
		$('#templateSelectionModal').modal('show');
	});	
}

function updateWeatherData()
{
	getWeatherData(function (response)
	{
		if (response != '')
		{
			var data = parseJson(response)[0];
			
			var temp = data.LastRawSecondData.Ta;
			if (parseInt(temp) === -999) temp = "";
			var rainfall = data.LastRawSecondData.Rc;
			if (parseInt(rainfall) === -999) rainfall = "";
			var windchill = data.LastRawSecondData.Wc; 
			if (parseInt(windchill) === -999) windchill = "";
			var humidity = data.LastRawSecondData.Ua; 
			if (parseInt(humidity) === -999) humidity = "";
			var windspeed = data.LastRawSecondData.Sx;
			if (parseInt(windspeed) === -999) windspeed = "";
			var winddir = getWindDirection(parseFloat(data.LastRawSecondData.Dx)); 
			var pressure = data.LastRawSecondData.Pa; 
			if (parseInt(pressure) === -999) pressure = "";
			var peakgust = data.LastRawSecondData.Wh; 		
			if (parseInt(peakgust) === -999) peakgust = "";
			var heatindex = data.LastRawSecondData.Hj;
			if (parseInt(heatindex) === -999) heatindex = "";
			var dewpoint = data.LastRawSecondData.Dp;
			if (parseInt(dewpoint) === -999) dewpoint = "";
		
			if (selectedTemplate == 0)
			{
				if (temp != '' && temp != undefined) $('#lblTemp').html(Math.round(temp) + '&#176; F'); 
				if (rainfall != '' && rainfall != undefined) $('#lblRainfall').html(rainfall);
				if (windchill != '' && windchill != undefined) $('#lblWindChill').html(Math.round(windchill) + '&#176; F'); 
				if (humidity != '' && humidity != undefined) $('#lblHumidity').html(Math.round(humidity) + "%"); 
				if (windspeed != '' && windspeed != undefined) $('#lblWindSpeed').html(Math.round(windspeed) + " mph");
				if (winddir != '' && winddir != undefined) $('#lblWindDir').html(winddir); 
				if (pressure != '' && pressure != undefined) $('#lblPressure').html(Math.round(pressure * 10) / 10 + " inHg"); 
				if (peakgust != '' && peakgust != undefined) $('#lblPeakGust').html(Math.round(peakgust) + " mph"); 	
				if (dewpoint != '' && dewpoint != undefined) $('#lblDewpt').html(Math.round(dewpoint) + '&#176; F');
				if (heatindex != '' && heatindex != undefined) $('#lblHeatIndex').html(Math.round(heatindex) + '&#176; F');
			}
			else
			{
				if (temp != '' && temp != undefined) 
				{
					$('#lblTemp').html(Math.round(temp)); 
					
					if (parseInt(temp) <= 50 && windchill != '' && windchill != undefined)
					{
						$('#lblFeelsLike').html(Math.round(windchill));
					}
					else if (parseInt(temp) > 50)
					{
						$('#lblFeelsLike').html(Math.round(heatindex));
					}
				}
				if (rainfall != '' && rainfall != undefined) $('#lblRainfall').html(rainfall); 
				if (humidity != '' && humidity != undefined) $('#lblHumidity').html(Math.round(humidity)); 
				if (windspeed != '' && windspeed != undefined) $('#lblWindSpeed').html(Math.round(windspeed));
				if (winddir != '' && winddir != undefined) $('#lblWindDir').html(winddir); 
				if (pressure != '' && pressure != undefined) $('#lblPressure').html(Math.round(pressure * 10) / 10); 
				if (peakgust != '' && peakgust != undefined) $('#lblPeakGust').html(Math.round(peakgust)); 						
			}
		}
	});
}

function getWindDirection(windDirection)
{
	var windText = "";
	
	if (windDirection > 337.5 || windDirection <= 22.5)
	{
		windText = "N ";
	}
	else if (windDirection > 22.5 && windDirection <= 67.5)
	{
		windText = "NE ";
	}
	else if (windDirection > 67.5 && windDirection <= 112.5)
	{
		windText = "E ";
	}
	else if (windDirection > 112.5 && windDirection <= 157.5)
	{
		windText = "SE ";
	}
	else if (windDirection > 157.5 && windDirection <= 202.5)
	{
		windText = "S ";
	}
	else if (windDirection > 202.5 && windDirection <= 247.5)
	{
		windText = "SW ";
	}
	else if (windDirection > 247.5 && windDirection <= 292.5)
	{
		windText = "W ";
	}
	else if (windDirection > 292.5 && windDirection <= 337.5)
	{
		windText = "NW ";
	}
	
	return windText;
}

function getWeatherData(callback)
{
	var r = Math.random();
	var url = "http://localhost:11100/?command=jsonobject weatherdata &r=" + r;
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", url, true); // true for asynchronous 
    xmlHttp.send(null);
}

function parseJson(jsonString) {
	if (jsonString != '')
	{
		return eval('(' + jsonString + ')');
	}
	else
	{
		return '';
	}
}

setInterval(updateWeatherData, 500);
loadTemplate(0);
</script>